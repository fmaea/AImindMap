<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ°è¡¨æ°´è‡ªåŠ¨ç›‘æµ‹æŠ€æœ¯è§„èŒƒ (HJ 915-2017) äº¤äº’å¼æ€ç»´å¯¼å›¾ (Geminiç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #f9fafb;
        }

        .tree-container {
            padding: 2rem;
            max-width: 1200px;
            margin: 2rem auto;
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        .tree ul {
            position: relative;
            padding-left: 30px;
            list-style: none;
        }

        .tree li {
            position: relative;
            padding: 4px 0 4px 25px;
        }

        .tree ul::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 1px;
            height: 100%;
            background-color: #d1d5db;
        }
        
        .tree li::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            width: 25px;
            height: 1px;
            background-color: #d1d5db;
        }
        
        .tree li::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 1px;
            height: 100%;
            background-color: #d1d5db;
        }

        .tree li:last-child::after {
            height: 15px;
        }
        
        .tree .node {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 8px;
            background-color: #f3f4f6;
            color: #374151;
            transition: all 0.2s ease;
            min-width: 100px;
            cursor: pointer;
            border: 1px solid #e5e7eb;
        }
        
        .tree .gemini-trigger, .tree .simulation-trigger {
            margin-left: 8px;
            font-size: 1.1rem;
            opacity: 0.6;
            transition: all 0.2s ease;
        }
        .tree .node:hover .gemini-trigger, .tree .node:hover .simulation-trigger {
            opacity: 1;
            transform: scale(1.2);
        }

        .tree li.has-children > .node {
            cursor: pointer;
            font-weight: 500;
            background-color: #e0e7ff;
            color: #3730a3;
        }
        
        .tree li.has-children > .node:hover {
             background-color: #c7d2fe;
             transform: translateY(-2px);
             box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        .tree li.root > .node {
            background-color: #312e81;
            color: white;
            font-weight: 700;
            font-size: 1.25rem;
        }

        .tree li.collapsed > ul {
            display: none;
        }

        .tree li.has-children > .node > .toggle-icon {
            content: 'âˆ’';
            display: inline-block;
            margin-right: 8px;
            font-weight: bold;
        }

        .tree li.has-children.collapsed > .node > .toggle-icon {
            content: '+';
        }
        
        .controls {
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .control-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid #d1d5db;
            background-color: #ffffff;
            color: #374151;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .control-btn:hover {
            background-color: #f3f4f6;
        }
        
        /* Modal Styles */
        .modal-content {
            white-space: pre-wrap;
            line-height: 1.7;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body>

    <div class="tree-container">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">åœ°è¡¨æ°´è‡ªåŠ¨ç›‘æµ‹æŠ€æœ¯è§„èŒƒ</h1>
        <p class="text-lg text-center text-gray-500 mb-8">(HJ 915-2017) äº¤äº’å¼æ€ç»´å¯¼å›¾ - Gemini å¢å¼ºç‰ˆ</p>
        
        <!-- Gemini Search Bar -->
        <div class="mb-8 max-w-2xl mx-auto">
            <form id="geminiSearchForm" class="flex items-center gap-2 p-2 border-2 border-indigo-200 rounded-full shadow-lg focus-within:border-indigo-500 transition-all">
                <input type="search" id="geminiSearchInput" placeholder="âœ¨ å°±è§„èŒƒå†…å®¹æé—®ï¼Œè®©Geminiä¸ºæ‚¨è§£ç­”..." class="w-full px-4 py-2 text-gray-700 bg-transparent focus:outline-none">
                <button type="submit" class="bg-indigo-600 text-white rounded-full p-2.5 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                    </svg>
                </button>
            </form>
        </div>

        <div class="controls space-x-4">
            <button id="expandAll" class="control-btn">å…¨éƒ¨å±•å¼€</button>
            <button id="collapseAll" class="control-btn">å…¨éƒ¨æŠ˜å </button>
        </div>

        <ul class="tree">
            <!-- Mindmap structure will be generated by JS -->
        </ul>
    </div>

    <!-- Gemini Modal -->
    <div id="geminiModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center hidden z-50">
        <div class="relative mx-auto p-5 border w-full max-w-3xl shadow-lg rounded-2xl bg-white">
            <h3 id="modalTitle" class="text-xl font-bold text-gray-800 mb-4"></h3>
            <div id="modalContent" class="modal-content text-gray-700 max-h-[60vh] overflow-y-auto pr-2">
                <!-- Gemini response will be injected here -->
            </div>
            <div id="modalActions" class="mt-4 text-right">
                 <!-- Action buttons will be injected here -->
            </div>
            <button id="closeModal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            const mindmapData = {
                text: "åœ°è¡¨æ°´è‡ªåŠ¨ç›‘æµ‹æŠ€æœ¯è§„èŒƒ (HJ 915-2017)",
                isRoot: true,
                children: [
                    { text: "ä¸€ã€ å¼•è¨€ä¸èŒƒå›´", children: [{ text: "ç›®çš„" }, { text: "æ³•å¾‹ä¾æ®" }, { text: "é€‚ç”¨èŒƒå›´" }, { text: "è§„èŒƒæ€§å¼•ç”¨" }] },
                    { text: "äºŒã€ æ ¸å¿ƒæœ¯è¯­å®šä¹‰", children: [{ text: "åœ°è¡¨æ°´æ°´è´¨è‡ªåŠ¨ç›‘æµ‹" }, { text: "æ°´ç«™" }, { text: "æ•°æ®å¹³å°" }, { text: "è‡ªåŠ¨ç›‘æµ‹ç³»ç»Ÿ" }, { text: "å¸¸è§„äº”å‚æ•°" }] },
                    { text: "ä¸‰ã€ ç³»ç»Ÿå»ºè®¾", children: [
                        { text: "æ€»ä½“è¦æ±‚" },
                        { text: "ç«™å€é€‰æ‹©", children: [{ text: "åŸåˆ™ï¼šå¯è¡Œæ€§ã€ä»£è¡¨æ€§ã€é•¿æœŸæ€§ã€å®‰å…¨æ€§ã€ç»æµæ€§" }, { text: "åŸºç¡€æ¡ä»¶ï¼šäº¤é€šã€ç”µåŠ›(â‰¥15kW)ã€æ°´æºã€é€šè®¯ç­‰" }, { text: "ä»£è¡¨æ€§ï¼šè¿œç¦»æ±¡æŸ“æº, é¿å…å›æ°´åŒº" }] },
                        { text: "ç«™æˆ¿å»ºè®¾", children: [{ text: "å½¢å¼ï¼šå›ºå®šå¼ã€ç®€æ˜“å¼ã€æµ®æ ‡ç«™ç­‰" }, { text: "å®‰å…¨è¦æ±‚ï¼šé˜²é›·ã€æŠ—éœ‡ã€é˜²æ´ªã€é˜²ç›—ç­‰" }, { text: "å›ºå®šç«™æˆ¿é…ç½®ï¼šä»ªå™¨é—´(â‰¥60mÂ²)ã€è´¨æ§é—´(â‰¥30mÂ²)" }, { text: "ç¯å¢ƒæ§åˆ¶ï¼šæ¸©åº¦18~28â„ƒï¼Œæ¹¿åº¦<60%" }]},
                        { text: "æ°´ç«™å„å•å…ƒå»ºè®¾", children: [{ text: "é‡‡é…æ°´å•å…ƒ (é‡‡æ°´ã€é¢„å¤„ç†ã€é…æ°´)" }, { text: "æ§åˆ¶å•å…ƒ (PLC, MTBFâ‰¥10000h)" }, { text: "æ£€æµ‹å•å…ƒ (ä»ªå™¨æ€§èƒ½éœ€ç¬¦åˆé™„å½•A.2)" }, { text: "æ•°æ®é‡‡é›†ä¸ä¼ è¾“å•å…ƒ (æœ¬åœ°å‚¨å­˜â‰¥1å¹´æ•°æ®)" }] },
                        { text: "æ•°æ®å¹³å°å»ºè®¾", children: [{ text: "æ ¸å¿ƒåŠŸèƒ½ï¼šæ•°æ®é‡‡é›†ã€è¿œç¨‹åæ§ã€åˆ†æç®¡ç†ã€æŠ¥è­¦" }, { text: "æŠ€æœ¯è¦æ±‚ï¼šå®‰å…¨ä¼ è¾“ã€å¯æ‰©å±•ã€è‡ªåŠ¨è¯†åˆ«æ— æ•ˆæ•°æ®" }] },
                    ]},
                    { text: "å››ã€ ç³»ç»ŸéªŒæ”¶", special: true, children: [{ text: "æ€»ä½“è¦æ±‚" }, { text: "éªŒæ”¶ç¨‹åº" }, { text: "åŸºæœ¬æ¡ä»¶ (è‡³å°‘è¿ç»­ç¨³å®šè¿è¡Œ30å¤©)" }, { text: "è¯¦ç»†å†…å®¹ (ç«™æˆ¿ã€ä»ªå™¨ã€æ•°æ®å¹³å°)" }] },
                    { text: "äº”ã€ è¿è¡Œç»´æŠ¤ (O&M)", special: true, children: [{ text: "æ€»ä½“è¦æ±‚" }, { text: "ä¾‹è¡Œç»´æŠ¤ (å·¡æ£€é¢‘æ¬¡ â‰¥ æ¯å‘¨ä¸€æ¬¡)" }, { text: "ä¿å…»æ£€ä¿® (æ¯å¹´è‡³å°‘1æ¬¡)" }, { text: "æ•…éšœæ£€ä¿®", simulatable: true }, { text: "æ•°æ®å¹³å°ç®¡ç†" }, { text: "è®°å½•è¦æ±‚" }] },
                    { text: "å…­ã€ è´¨é‡ä¿è¯ä¸è´¨é‡æ§åˆ¶ (QA/QC)", children: [
                        { text: "é‡å€¼ä¼ é€’è¦æ±‚ (ä½¿ç”¨æœ‰è¯æ ‡å‡†æ ·å“)" },
                        { text: "ä»ªå™¨æ€§èƒ½æ ¸æŸ¥", children: [{ text: "å†…å®¹ï¼šå‡†ç¡®åº¦ã€ç²¾å¯†åº¦ã€æ£€å‡ºé™ç­‰" }, { text: "é¢‘ç‡ï¼šå¤§éƒ¨åˆ†æŒ‡æ ‡â‰¥æ¯åŠå¹´ä¸€æ¬¡ï¼Œæ ¡å‡†â‰¥æ¯æœˆä¸€æ¬¡" }, { text: "æ–¹æ³•ä¸å…¬å¼" }, { text: "å®é™…æ°´æ ·æ¯”å¯¹" }] },
                    ]},
                    { text: "ä¸ƒã€ æ•°æ®é‡‡é›†ä¸æœ‰æ•ˆæ€§", simulatable: true, children: [{ text: "é‡‡é›†é¢‘ç‡ (ä¸€èˆ¬4å°æ—¶/æ¬¡)" }, { text: "æ•°æ®æœ‰æ•ˆæ€§ (å­˜ç–‘æ•°æ®24hå†…ç”„åˆ«)" }, { text: "æ•°æ®æœ‰æ•ˆç‡ (>90%)" }] },
                    { text: "å…«ã€ ä¿éšœåˆ¶åº¦", children: [{ text: "è¿è¡Œç®¡ç†åŠæ³•" }, { text: "å²—ä½èŒè´£" }, { text: "è´¨é‡ç®¡ç†ä¿éšœåˆ¶åº¦" }, { text: "ä»ªå™¨æ“ä½œè§„ç¨‹ (SOPs)" }, { text: "åŸ¹è®­åŠè€ƒæ ¸åˆ¶åº¦" }, { text: "æ¡£æ¡ˆç®¡ç†åˆ¶åº¦" }] },
                    { text: "ä¹ã€ ç›‘æµ‹é¡¹ç›®ä¸ä»ªå™¨æ€§èƒ½", children: [
                        { text: "ç›‘æµ‹é¡¹ç›®", children: [{ text: "æ²³æµå¿…æµ‹ï¼šå¸¸è§„äº”å‚æ•°ã€é«˜é”°é…¸ç›æŒ‡æ•°ã€æ°¨æ°®ã€æ€»ç£·ã€æ€»æ°®" }, { text: "æ¹–åº“å¿…æµ‹ï¼šå¢åŠ å¶ç»¿ç´ a" }, { text: "é€‰æµ‹é¡¹ç›®" }] },
                        { text: "ä»ªå™¨æ€§èƒ½è¦æ±‚ (é™„å½•A.2)", children: [{ text: "è§„èŒƒæ€§é™„å½•ï¼Œå…·å¼ºåˆ¶æ€§" }, { text: "è§„å®šå…·ä½“æŠ€æœ¯æŒ‡æ ‡ (æ£€å‡ºé™ã€ç²¾å¯†åº¦ç­‰)" }, { text: "æä¾›é‡åŒ–åŸºå‡†" }] },
                    ]}
                ]
            };

            const treeContainer = document.querySelector('.tree');
            treeContainer.innerHTML = ''; // Clear static content
            treeContainer.appendChild(createTree(mindmapData));

            function createTree(nodeData) {
                const li = document.createElement('li');
                const span = document.createElement('span');
                span.className = 'node';
                span.textContent = nodeData.text;

                if (nodeData.isRoot) {
                    li.classList.add('root');
                }

                if (nodeData.children && nodeData.children.length > 0) {
                    li.classList.add('has-children');
                    const toggleIcon = document.createElement('span');
                    toggleIcon.className = 'toggle-icon';
                    toggleIcon.textContent = 'âˆ’';
                    span.prepend(toggleIcon);

                    const ul = document.createElement('ul');
                    nodeData.children.forEach(child => ul.appendChild(createTree(child)));
                    li.appendChild(span);
                    li.appendChild(ul);
                } else {
                    li.appendChild(span);
                }
                
                if (!nodeData.isRoot) {
                    const geminiTrigger = document.createElement('span');
                    geminiTrigger.className = 'gemini-trigger';
                    geminiTrigger.title = 'âœ¨ æ™ºèƒ½è§£è¯»';
                    geminiTrigger.innerHTML = 'âœ¨';
                    span.appendChild(geminiTrigger);
                    geminiTrigger.addEventListener('click', (e) => {
                        e.stopPropagation();
                        openGeminiModalForNode(nodeData.text, nodeData.special);
                    });
                    
                    if (nodeData.simulatable) {
                        const simTrigger = document.createElement('span');
                        simTrigger.className = 'simulation-trigger';
                        simTrigger.title = 'ğŸ§  AIåœºæ™¯æ¨¡æ‹Ÿ';
                        simTrigger.innerHTML = 'ğŸ§ ';
                        span.appendChild(simTrigger);
                        simTrigger.addEventListener('click', (e) => {
                            e.stopPropagation();
                            openSimulationModal(nodeData.text);
                        });
                    }
                }
                return li;
            }

            const tree = document.querySelector('.tree');
            tree.addEventListener('click', function (event) {
                const target = event.target;
                if (target.matches('.node, .toggle-icon')) {
                    const parentLi = target.closest('li.has-children');
                    if (parentLi) {
                        parentLi.classList.toggle('collapsed');
                        const toggleIcon = parentLi.querySelector('.toggle-icon');
                        toggleIcon.textContent = parentLi.classList.contains('collapsed') ? '+' : 'âˆ’';
                    }
                }
            });

            document.getElementById('expandAll').addEventListener('click', function() {
                tree.querySelectorAll('li.has-children').forEach(node => {
                    node.classList.remove('collapsed');
                    if(node.querySelector('.toggle-icon')) node.querySelector('.toggle-icon').textContent = 'âˆ’';
                });
            });

            document.getElementById('collapseAll').addEventListener('click', function() {
                tree.querySelectorAll('li.has-children').forEach(node => {
                    if (!node.classList.contains('root')) {
                        node.classList.add('collapsed');
                         if(node.querySelector('.toggle-icon')) node.querySelector('.toggle-icon').textContent = '+';
                    }
                });
            });

            document.getElementById('collapseAll').click();
            document.querySelector('.tree > li.root').classList.remove('collapsed');

            const modal = document.getElementById('geminiModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const modalActions = document.getElementById('modalActions');
            const closeModalBtn = document.getElementById('closeModal');

            closeModalBtn.addEventListener('click', () => modal.classList.add('hidden'));
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                }
            });
            
            async function callGeminiAPI(prompt) {
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const result = await response.json();
                    if (result.candidates && result.candidates[0].content.parts.length > 0) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        return "æŠ±æ­‰ï¼Œæ— æ³•è·å–AIå“åº”ã€‚è¯·ç¨åå†è¯•ã€‚";
                    }
                } catch(error) {
                    console.error("Gemini API call failed:", error);
                    return "è°ƒç”¨AIæœåŠ¡å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åå†è¯•ã€‚";
                }
            }

            async function openModalWithContent(title, contentPromise) {
                modal.classList.remove('hidden');
                modalTitle.textContent = title;
                modalContent.innerHTML = '<div class="flex justify-center items-center h-48"><div class="spinner"></div></div>';
                modalActions.innerHTML = '';
                const result = await contentPromise;
                modalContent.textContent = result;
            }

            async function openGeminiModalForNode(nodeText, isSpecial) {
                const prompt = `è¯·æ ¹æ®ã€Šåœ°è¡¨æ°´è‡ªåŠ¨ç›‘æµ‹æŠ€æœ¯è§„èŒƒ HJ 915-2017ã€‹çš„å†…å®¹ï¼Œç”¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€è¯¦ç»†è§£é‡Š'${nodeText}'è¿™ä¸€èŠ‚çš„æ ¸å¿ƒå†…å®¹å’Œé‡è¦æ€§ã€‚`;
                openModalWithContent(`å…³äºâ€œ${nodeText}â€çš„æ™ºèƒ½è§£è¯»`, callGeminiAPI(prompt));

                if (isSpecial) {
                    const interpretationPromise = callGeminiAPI(prompt);
                    const result = await interpretationPromise;
                    modalContent.textContent = result;

                    const checklistBtn = document.createElement('button');
                    checklistBtn.className = 'control-btn bg-blue-500 text-white hover:bg-blue-600';
                    checklistBtn.innerHTML = 'âœ¨ ç”Ÿæˆæ£€æŸ¥æ¸…å•';
                    checklistBtn.onclick = async () => {
                         const checklistPrompt = `æ ¹æ®ã€Šåœ°è¡¨æ°´è‡ªåŠ¨ç›‘æµ‹æŠ€æœ¯è§„èŒƒ HJ 915-2017ã€‹ä¸­å…³äº'${nodeText}'çš„å…¨éƒ¨è¦æ±‚ï¼Œç”Ÿæˆä¸€ä»½è¯¦ç»†ã€å¯æ“ä½œçš„ç°åœºæ£€æŸ¥æ¸…å•ï¼Œè¯·ä½¿ç”¨Markdownæ ¼å¼ã€‚`;
                         openModalWithContent(`â€œ${nodeText}â€æ£€æŸ¥æ¸…å•`, callGeminiAPI(checklistPrompt));
                    };
                    modalActions.appendChild(checklistBtn);
                }
            }
            
            async function openSimulationModal(nodeText) {
                modal.classList.remove('hidden');
                modalTitle.textContent = `å…³äºâ€œ${nodeText}â€çš„åœºæ™¯æ¨¡æ‹Ÿ`;
                modalContent.innerHTML = '<div class="flex justify-center items-center h-48"><div class="spinner"></div></div>';
                modalActions.innerHTML = '';

                const scenarioPrompt = `æ‚¨æ˜¯ä¸€ååœ°è¡¨æ°´è‡ªåŠ¨ç›‘æµ‹ç«™çš„è¿ç»´åŸ¹è®­ä¸“å®¶ã€‚è¯·æ ¹æ®ã€Šåœ°è¡¨æ°´è‡ªåŠ¨ç›‘æµ‹æŠ€æœ¯è§„èŒƒ HJ 915-2017ã€‹å…³äº'${nodeText}'çš„è¦æ±‚ï¼Œè®¾è®¡ä¸€ä¸ªå¸¸è§çš„ã€å…·ä½“çš„å®è·µåœºæ™¯é—®é¢˜æ¥æŒ‘æˆ˜ç”¨æˆ·ã€‚è¯·ä»¥åœºæ™¯æè¿°å’Œæé—®çš„æ–¹å¼å‘ˆç°ï¼Œå¼•å¯¼ç”¨æˆ·æ€è€ƒå¦‚ä½•åº”å¯¹ã€‚`;
                const scenario = await callGeminiAPI(scenarioPrompt);
                modalContent.textContent = scenario;
                
                const solutionBtn = document.createElement('button');
                solutionBtn.className = 'control-btn bg-green-500 text-white hover:bg-green-600';
                solutionBtn.innerHTML = 'æŸ¥çœ‹è§£å†³æ–¹æ¡ˆ';
                solutionBtn.onclick = async () => {
                    modalContent.innerHTML = '<div class="flex justify-center items-center h-48"><div class="spinner"></div></div>';
                    const solutionPrompt = `é’ˆå¯¹ä»¥ä¸‹åœºæ™¯é—®é¢˜ï¼šâ€œ${scenario}â€ã€‚è¯·æ ¹æ®ã€Šåœ°è¡¨æ°´è‡ªåŠ¨ç›‘æµ‹æŠ€æœ¯è§„èŒƒ HJ 915-2017ã€‹çš„è¦æ±‚ï¼Œæä¾›ä¸€ä»½æ ‡å‡†ã€è¯¦ç»†çš„è§£å†³æ–¹æ¡ˆå’Œå¤„ç†æµç¨‹ã€‚`;
                    const solution = await callGeminiAPI(solutionPrompt);
                    modalContent.textContent = solution;
                    modalActions.innerHTML = ''; // Hide button after showing solution
                };
                modalActions.appendChild(solutionBtn);
            }

            const searchForm = document.getElementById('geminiSearchForm');
            const searchInput = document.getElementById('geminiSearchInput');
            searchForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const query = searchInput.value.trim();
                if (!query) return;
                const prompt = `æ‚¨æ˜¯ä¸€ä½ç†Ÿæ‚‰ã€Šåœ°è¡¨æ°´è‡ªåŠ¨ç›‘æµ‹æŠ€æœ¯è§„èŒƒ HJ 915-2017ã€‹çš„ä¸“å®¶ã€‚è¯·æ ¹æ®è¯¥è§„èŒƒçš„è¯¦ç»†å†…å®¹ï¼Œå›ç­”ä»¥ä¸‹é—®é¢˜ï¼šâ€œ${query}â€ã€‚è¯·ç¡®ä¿æ‚¨çš„å›ç­”å‡†ç¡®ã€è¯¦ç»†ï¼Œå¹¶å°½å¯èƒ½å¼•ç”¨è§„èŒƒä¸­çš„å…³é”®ç‚¹ã€‚`;
                openModalWithContent(`å…³äºâ€œ${query}â€çš„è§£ç­”`, callGeminiAPI(prompt));
                searchInput.value = '';
            });
        });
    </script>
</body>
</html>
