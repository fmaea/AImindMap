# 地表水自动监测技术规范 (HJ 915-2017) - 交互式AI思维导图

本项目是一个交互式的思维导图，旨在帮助用户理解和学习《地表水自动监测技术规范 (HJ 915-2017)》。它结合了AI技术，为规范的各个章节提供智能解读、场景模拟和问答功能。

## 主要功能

*   **交互式思维导图浏览**：用户可以方便地展开和折叠规范的各个章节和条款。
*   **AI智能解读**：点击思维导图中的节点，可以获取由AI（Gemini或DeepSeek模型）生成的对该节点内容的详细解释和重要性说明。
*   **AI智能问答**：内置搜索框，用户可以就规范内容自由提问，AI将根据规范给出解答。
*   **章节测验**：部分重要章节配有小测验，帮助用户巩固学习效果。
*   **场景模拟**：针对特定操作或要求，提供AI驱动的场景模拟，帮助用户理解在实际操作中如何应用规范。
*   **AI模型选择**：用户可以选择使用 Google Gemini 或 DeepSeek 作为后端AI模型。
*   **API密钥本地存储**：用户的API密钥将安全地存储在浏览器的本地存储中，不会上传到其他任何地方。
*   **导入思维导图 (Import Mind Map)**: 用户可以导入外部的JSON文件来替换当前显示的思维导图内容。
*   **知识库集成 (Knowledge Base Integration)**: 用户可以加载本地知识库文件（JSON格式），其内容可用于增强AI对思维导图节点的解释，或进行独立查询。

## 如何使用

1.  **打开文件**：在现代的网页浏览器中打开 `AI思维导图.html` 文件。
2.  **选择AI模型**：在页面上方的设置区域，选择您希望使用的AI模型（Gemini 或 DeepSeek）。
3.  **配置API密钥**：
    *   输入您所选AI模型的有效API密钥。
    *   点击“保存密钥”按钮。密钥将保存在您浏览器的本地存储中，仅用于与相应的AI服务接口通信。
    *   如果需要更换或清除密钥，可以使用相应的“清除密钥”按钮。
4.  **浏览与交互**：
    *   点击思维导图节点旁的 `+` 或 `-` 图标来展开或折叠分支。
    *   点击节点文字右侧的 ✨ 图标，AI会对该章节进行智能解读。
    *   部分节点提供 🧠 图标，点击可进入AI场景模拟。
    *   部分节点解读后会提供 📝 图标，点击可开始章节测验。
    *   使用页面上方的搜索框就规范内容进行提问。
5.  **导入自定义思维导图 (Import Custom Mind Map):**
    *   在 "全部展开" / "全部折叠" 按钮附近，您会找到一个文件选择框和一个 "导入思维导图" 按钮。
    *   点击文件选择框，选择一个本地的 JSON 文件。
    *   该JSON文件应代表一个思维导图的结构。根对象应包含 `text` (字符串类型) 属性和可选的 `children` (数组类型) 属性。
    *   `children` 数组中的每个元素也应为一个对象，包含 `text` 属性和可选的 `children` 属性。
    *   示例JSON结构:
        ```json
        {
          "text": "我的自定义根节点",
          "isRoot": true, // 可选，但建议根节点使用
          "children": [
            {
              "text": "子节点1",
              "children": [
                { "text": "孙子节点A" }
              ]
            },
            { "text": "子节点2" }
          ]
        }
        ```
    *   选择文件后，点击 "导入思维导图" 按钮。
    *   如果文件有效，当前思维导图将被替换为导入的内容。如果文件无效或格式不正确，将显示错误消息。
    *   **注意**: 导入功能会替换当前显示的思维导图。如果您想保留当前内容，请确保在导入前有其他备份。

## 知识库功能 (Knowledge Base Feature)

### a. 概述 (Overview)
用户可以从本地加载一个JSON格式的自定义知识库文件。加载后，知识库中的文档内容可以：
1.  为AI解释思维导图节点时提供额外的背景知识。
2.  允许用户直接对已加载的全部知识库内容进行提问。

### b. 准备知识库JSON文件 (Preparing the Knowledge Base JSON File)
*   文件必须是 `.json` 格式。
*   文件内容必须遵循特定的结构。根对象应包含一个名为 `knowledgeBase` 的键，其值是一个对象。此对象可以有一个可选的 `name` 属性（字符串类型，用于描述知识库），并且必须有一个 `documents` 属性（数组类型）。
*   `documents` 数组中的每一个元素都是一个独立的文档对象，每个文档对象必须包含：
    *   `title` (字符串类型): 文档的标题。
    *   `content` (字符串类型): 文档的纯文本内容。
*   **文件大小限制**: 为了保证浏览器性能，建议导入的JSON文件大小不要超过约10MB。过大的文件可能会导致加载失败或浏览器响应缓慢。

*   **示例JSON结构:**
    ```json
    {
      "knowledgeBase": {
        "name": "我的自定义知识文档",
        "documents": [
          {
            "title": "文档标题1：关于XXX的介绍",
            "content": "这是文档1的详细文本内容...\n可以包含多行文本。"
          },
          {
            "title": "文档标题2：YYY的规格说明",
            "content": "文档2的详细文本内容...\n关键点A、关键点B..."
          }
        ]
      }
    }
    ```

### c. 加载和管理知识库 (Loading and Managing the Knowledge Base)
*   在API密钥配置区域下方，您会找到 "知识库管理 (Knowledge Base)" 部分。
*   **加载知识库**:
    1.  点击 "选择文件" (Choose File) 按钮，选择您本地的知识库JSON文件。
    2.  点击 "加载知识库" (Load Knowledge Base) 按钮。
    3.  如果文件有效且符合结构要求及大小限制，系统会提示加载成功，并且文档标题会显示在 "已加载文档 (Loaded Documents)" 列表中。
    4.  加载的知识库数据会存储在浏览器的本地存储 (localStorage) 中。这意味着关闭浏览器或刷新页面后，之前加载的知识库会自动重新载入。
*   **查看已加载文档**: "已加载文档" 列表会显示所有成功导入的文档标题。如果文档过多，该列表区域可以滚动查看。
*   **清除知识库**:
    1.  点击 "清除知识库" (Clear Knowledge Base) 按钮。
    2.  这将从浏览器本地存储中移除知识库数据，清空 "已加载文档" 列表，并重置任何已激活的知识库上下文。

### d. 在思维导图解释中使用知识库 (Using Knowledge Base for Mind Map Explanations)
*   **选择激活上下文**: 在 "已加载文档" 列表中，通过点击任意文档的标题，可以将其选为 "当前激活上下文 (Active Context)"。所选文档的标题将显示在列表下方。
*   **增强AI解读**: 当有文档被激活作为上下文后，如果您点击思维导图节点旁的 ✨ 图标请求AI解读，该激活文档的 *全部内容* 将会作为背景知识一同发送给AI。AI会被引导参考此背景知识以及《地表水自动监测技术规范 HJ 915-2017》的整体内容进行解释。如果背景知识与规范内容有冲突，AI被要求以规范内容为准。
*   **取消激活**: 再次点击已激活的文档标题，可以取消其激活状态，"当前激活上下文" 将显示 "无 (None)"。之后请求AI解读时，将不再附带该文档的背景知识。

### e. 直接查询知识库 (Querying the Knowledge Base Directly)
*   在 "知识库管理" 部分，您会找到 "查询知识库 (Query Knowledge Base)" 输入框和旁边的搜索按钮。
*   **进行查询**:
    1.  确保您已成功加载了知识库。
    2.  在输入框中输入您想基于已加载知识库内容提出的问题。
    3.  点击搜索按钮。
*   **获取答案**: AI将基于您加载的 *所有文档* 的全部内容来回答您的问题。答案将显示在弹出的模态窗口中。
    *   **注意**: 此查询功能会将所有已加载文档的内容合并后发送给AI。如果文档总内容过长（例如超过约25000字符），内容会被截断以适应AI模型的输入限制，并会显示一条警告消息。

## 注意事项

*   **API密钥**：您需要自行获取所选AI模型（Google Gemini 或 DeepSeek）的API密钥。本工具不提供API密钥。
*   **浏览器兼容性**：建议使用最新版本的Chrome、Edge、Firefox或Safari浏览器以获得最佳体验。
*   **本地存储**：API密钥存储在浏览器的Local Storage中。清除浏览器缓存或在隐私模式下使用可能会导致已保存的密钥丢失。

## 技术栈

*   HTML
*   Tailwind CSS
*   JavaScript

## 隐私声明

用户提供的API密钥仅存储在用户浏览器的本地存储中，用于与用户选择的AI服务（Gemini API或DeepSeek API）进行通信。这些密钥不会被发送到本应用开发者或任何第三方服务器。所有AI交互均直接在用户浏览器和相应的AI服务提供商之间进行。
